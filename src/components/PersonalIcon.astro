---
interface Props {
  size?: number;
  class?: string;
}

const { size = 24, class: className = "" } = Astro.props;
---

<button
  type="button"
  class={`personal-icon ${className}`}
  style={`--pi-size: ${size}px`}
  aria-label="Toggle theme"
  data-theme-toggle-icon
>
  <!-- Dark mode shows the light icon -->
  <img src="/icons/IconLightMode.svg" class="pi__dark" alt="" decoding="async" />
  
  <!-- Light mode shows the dark icon -->
  <img src="/icons/icondarkoptimized.svg" class="pi__light" alt="" decoding="async" />
</button>

<style>
  .personal-icon {
    /* Reset button styles */
    appearance: none;
    border: none;
    background: transparent;
    padding: 0;
    cursor: pointer;
    
    /* Layout */
    display: inline-grid;
    place-items: center;
    width: var(--pi-size, 24px);
    height: var(--pi-size, 24px);
    border-radius: 20%;
    
    /* No box-shadow on container to prevent white halo */
    box-shadow: none;
    
    /* Smooth animations */
    transition:
      transform 260ms cubic-bezier(0.2, 0.8, 0.2, 1),
      box-shadow 260ms cubic-bezier(0.2, 0.8, 0.2, 1);
    
    /* Performance hints */
    will-change: transform, box-shadow;
    transform: translateZ(0);
    
    /* Ensure proper stacking */
    position: relative;
    isolation: isolate;
  }

  /* Enhanced hover state - scale only, no shadow */
  .personal-icon:hover {
    transform: scale(1.03) translateZ(0);
    box-shadow: none;
  }

  /* Active/pressed state - Apple-like press down */
  .personal-icon:active {
    transform: scale(0.96) translateZ(0);
    transition-duration: 80ms;
  }

  /* Focus state - accessible outline */
  .personal-icon:focus-visible {
    outline: 2px solid var(--pi-focus-ring);
    outline-offset: 3px;
  }

  /* Stacked images and HTML icons with grid overlay */
  .personal-icon img,
  .personal-icon > div {
    grid-area: 1 / 1;
    width: 100%;
    height: 100%;
    display: block;
    pointer-events: none;
    user-select: none;
    -webkit-user-drag: none;
    
    /* Remove all borders, frames, and backgrounds */
    border: none !important;
    outline: none !important;
    background: transparent !important;
    background-color: transparent !important;
    
    /* Smooth cross-fade transition */
    opacity: 0;
    transition: opacity 220ms cubic-bezier(0.2, 0.8, 0.2, 1);
  }
  
  .personal-icon img {
    /* Image-specific styles */
    box-shadow: none !important;
    object-fit: contain;
    object-position: center;
  }

  /* Theme-based visibility - controlled by global CSS variables */
  .personal-icon .pi__dark {
    opacity: var(--pi-dark, 1);
  }

  .personal-icon .pi__light {
    opacity: var(--pi-light, 0);
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .personal-icon,
    .personal-icon img {
      transition: none !important;
    }
    
    .personal-icon:hover,
    .personal-icon:active {
      transform: none !important;
    }
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .personal-icon {
      outline: 1px solid currentColor;
      outline-offset: 2px;
    }
  }
</style>

<script type="module">
  void (async () => {
    const { initThemeController, toggleTheme } = await import("../scripts/theme-controller.ts");

    if (typeof window === "undefined") {
      return;
    }

    initThemeController();

    const iconButtons =
      document.querySelectorAll<HTMLButtonElement>("[data-theme-toggle-icon]");

    iconButtons.forEach((button) => {
      if (button.dataset.themeToggleBound === "true") {
        return;
      }
      button.dataset.themeToggleBound = "true";
      button.addEventListener("click", () => {
        toggleTheme({ persist: true });
      });
    });
  })();
</script>
