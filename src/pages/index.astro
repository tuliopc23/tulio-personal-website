---
import Base from "../layouts/Base.astro";
import "../styles/section.css";
import Card from "../components/Card.astro";
import ProfileCard from "../components/ProfileCard.astro";
import { getAllPosts } from "../sanity/lib/posts";

const posts = await getAllPosts();
const featuredWriting = posts.slice(0, 3);

const fallbackWriting = [
  {
    slug: "liquid-glass",
    title: "Liquid glass on the web",
    summary:
      "How to recreate Apple's materials with CSS blur, transparency, and borders.",
    tint: "pink" as const,
  },
  {
    slug: "sidebar-ux",
    title: "Sidebar UX like Apple Docs",
    summary: "Sticky sections, quick filter, and semantics.",
    tint: "indigo" as const,
  },
  {
    slug: "system-fonts",
    title: "System font stacks",
    summary: "Use -apple-system and friends correctly.",
    tint: "teal" as const,
  },
];

const tintByTag: Record<string, string> = {
  design: "pink",
  accessibility: "teal",
  tooling: "indigo",
  engineering: "blue",
  swift: "orange",
  frontend: "indigo",
  ux: "pink",
};

const writingCards =
  featuredWriting.length === 0
    ? fallbackWriting.map((item) => ({
        title: item.title,
        summary: item.summary,
        href: `/blog/${item.slug}/`,
        tint: item.tint,
      }))
    : featuredWriting.map((post, index) => {
        const fallbackTint = fallbackWriting[index]?.tint ?? "indigo";
        const tagTint = post.tags
          .map((tag) => tintByTag[tag.toLowerCase()])
          .find(Boolean);
        return {
          title: post.title,
          summary: post.summary,
          href: `/blog/${post.slug}/`,
          tint: tagTint ?? fallbackTint,
        };
      });
---

<Base title="Home" sidebar={true}>
  <section
    class="hero container"
    data-reveal
    data-reveal-type="scale"
    data-reveal-group="home-hero"
  >
    <h1 class="hero__title">Hi, I'm Tulio Cunha.</h1>
    <p class="hero__subtitle">
      Full stack developer crafting native and web tools with calm detail and reliable
      execution.
    </p>
  </section>

  <section class="container home__section" data-reveal data-reveal-group="home-profile">
    <ProfileCard
      name="Tulio Cunha"
      title="Full Stack Developer"
      location="Brazil"
      email="contact@tuliocunha.dev"
    />
    <div class="home__quickLinks cardRail">
      <Card
        title="Projects"
        body="Apple-inspired work across native and web—design systems, terminal interfaces, and tooling."
        href="/projects"
        tint="indigo"
        icon="projects"
        cta="Browse projects →"
        revealGroup="home-links"
        revealOrder={0}
      />
      <Card
        title="Blog"
        body="Notes on engineering, experiences, products, tastes, and tips worth sharing."
        href="/blog/"
        tint="indigo"
        icon="blog"
        cta="Browse the journal →"
        revealGroup="home-links"
        revealOrder={1}
      />
    </div>
  </section>

  <section class="container" data-reveal data-reveal-group="home-tech">
    <h2
      class="section-title"
      data-reveal
      data-reveal-group="home-tech"
      data-reveal-order={0}
    >
      Tech stack
    </h2>
    <div class="cardGrid cardRail">
      <Card
        title="Swift"
        body="Native macOS and iOS development."
        href="#"
        tint="orange"
        icon="swift"
        cta=""
        revealGroup="home-tech"
        revealOrder={1}
      />
      <Card
        title="TypeScript"
        body="Structured web applications."
        href="#"
        tint="blue"
        icon="typescript"
        cta=""
        revealGroup="home-tech"
        revealOrder={2}
      />
      <Card
        title="Rust"
        body="Systems programming with safety."
        href="#"
        tint="brown"
        icon="rust"
        cta=""
        revealGroup="home-tech"
        revealOrder={3}
      />
      <Card
        title="Zig"
        body="Low-level ergonomics and performance."
        href="#"
        tint="yellow"
        icon="zig"
        cta=""
        revealGroup="home-tech"
        revealOrder={4}
      />
      <Card
        title="Go"
        body="Backend services and tooling."
        href="#"
        tint="cyan"
        icon="go"
        cta=""
        revealGroup="home-tech"
        revealOrder={5}
      />
      <Card
        title="React"
        body="Component-driven UI."
        href="#"
        tint="cyan"
        icon="react"
        cta=""
        revealGroup="home-tech"
        revealOrder={6}
      />
      <Card
        title="Svelte"
        body="Motion-forward, compiled interfaces."
        href="#"
        tint="orange"
        icon="svelte"
        cta=""
        revealGroup="home-tech"
        revealOrder={7}
      />
      <Card
        title="Vue"
        body="Progressive web app craftsmanship."
        href="#"
        tint="green"
        icon="vue"
        cta=""
        revealGroup="home-tech"
        revealOrder={8}
      />
      <Card
        title="Docker"
        body="Portable environments and deployment pipelines."
        href="#"
        tint="indigo"
        icon="docker"
        cta=""
        revealGroup="home-tech"
        revealOrder={9}
      />
    </div>
  </section>

  <section class="container" data-reveal data-reveal-group="home-writing">
    <h2
      class="section-title"
      data-reveal
      data-reveal-group="home-writing"
      data-reveal-order={0}
    >
      Featured writing
    </h2>
    <div class="cardGrid cardRail">
      {
        writingCards.map((entry, index) => (
          <Card
            title={entry.title}
            body={entry.summary}
            href={entry.href}
            tint={entry.tint}
            icon="sparkle"
            cta="Read article →"
            revealGroup="home-writing"
            revealOrder={index + 1}
          />
        ))
      }
    </div>
  </section>
</Base>
